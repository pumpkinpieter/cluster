#!/usr/bin/bash
#SBATCH --job-name arfemb 
#SBATCH -N 49
#SBATCH -n 49
#SBATCH --tasks-per-node 1
#SBATCH --cpus-per-task 20
#SBATCH --partition medium
#SBATCH --mem 0
#SBATCH --output=logs/log.out
#SBATCH --error=errors/log.out
#SBATCH --mail-type=ALL
#SBATCH --mail-user=piet2@pdx.edu

# Load needed modules.
module load ngsolve/myserial
module load gcc-9.2.0
module load intel

#rm errors/*.err
#rm logs/*.out

# Run the code.
echo "Starting convergence study: "
date
for i in 45 57 59 60 61 64 68 69 73 92 94 107 133 136 138 149 \
    151 158 159 162 164 165 170 180 183 187 191 192 193 209 210 \
    211 213 214 221 223 230 235 242 243 244 245 252 256 259 261 \
    264 267 269 275 276 280 281 282 284 285 287 288 295 296 298 \
    303 309 310 311 314 320 324 327 335 338 340 342 343 346 347 \
    349 362 364 365 366 367 369 375 378 381 387 388 389 395 397 \
    399 404 405 409 416 417 418 420 424 425 426 433 434 435 442 \
    447 453 455 457 466 467 473 484 487 488 494 496 497 499 502 \
    503 508 510 516 517 526 530 531 534 535 539 541 542 545 546 \
    547 550 551 557 559 564 568 573 575 576 578 579 581 588 591 \
    593 596 598 604 606 611 613 615 620 621 622 624 629 633 644 \
    648 653 656 658 665 669 682 684 687 700 708 710 715 721 731 \
    735 740 742 744 748 749 758 761 762 765 766 767 769 776 778 \
    779 781 783 788 800 804 805 807 808 815 816 818 825 832 846 \
    848 854 864 866 874 876 879 904 907 910 911 913 918 921 925 \
    926 927 929 937 938 941 943 952 955 958 962 963 965 971 996 \
    1002 1006 1007 1008 1022 1023 1024 1031 1033 1034 1041 1047 \
    1056 1065 1069 1073 1074 1080 1082 1083 1087 1098 1108 1112 \
    1121 1122 1123 1126 1132 1139 1142 1151 1152 1156 1159 1165 \
    1166 1171 1188 1193 1197 1201 1202 1205 1208 1209 1210 1212 \
    1213 1214 1215 1222 1223 1237 1238 1242 1260 1262 1270 1271 \
    1276 1277 1282 1286 1288 1289 1291 1292 1293 1295 1302 1308 \
    1322 1327 1329 1332 1333 1340 1341 1342 1347 1359 1361 1362 \
    1367 1371 1386 1389 1403 1410 1413 1419 1438 1439 1442 1457 \
    1459 1460 1463 1482 1489 1490 1493 1495 1498
    do
        module load ngsolve/myserial gcc-9.2.0 intel
        srun --unbuffered --nodes 1 --ntasks 1 \
            --output="logs/e_${i}_task_%s.out" \
            --error="errors/e_${i}_task_%s.err" \
            python3 emb_modes.py 0 5 ${i} &
done
wait
